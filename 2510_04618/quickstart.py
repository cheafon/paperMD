#!/usr/bin/env python3
"""
ACE å¿«é€Ÿå…¥é—¨è„šæœ¬
æ— éœ€é…ç½®å³å¯äº†è§£ACEçš„å·¥ä½œæµç¨‹(ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼)
"""

import json
import os
from datetime import datetime
from dataclasses import dataclass, asdict
from typing import List, Dict, Any, Optional


# ç®€åŒ–çš„æ•°æ®ç»“æ„
@dataclass
class Bullet:
    id: str
    section: str
    content: str
    created_at: str = ""

    def __post_init__(self):
        if not self.created_at:
            self.created_at = datetime.now().isoformat()


class MockACEDemo:
    """
    ACEæ¼”ç¤ºç‰ˆæœ¬ - ä¸éœ€è¦APIå¯†é’¥
    å±•ç¤ºä¸‰æ­¥å·¥ä½œæµç¨‹çš„æ¦‚å¿µ
    """

    def __init__(self):
        self.playbook_bullets = []

    def demonstrate_workflow(self):
        """æ¼”ç¤ºACEçš„å®Œæ•´å·¥ä½œæµç¨‹"""
        print("\n" + "="*70)
        print("ğŸ“ ACE (Agentic Context Engineering) å·¥ä½œæµç¨‹æ¼”ç¤º")
        print("="*70)

        # ç¤ºä¾‹ä»»åŠ¡
        task = "ç¼–å†™Pythonä»£ç è®¡ç®—1åˆ°100ä¹‹é—´æ‰€æœ‰å¶æ•°çš„å’Œ"

        print(f"\nğŸ“‹ ä»»åŠ¡: {task}")
        print("\n" + "-"*70)

        # Step 1: Generator
        print("\nã€æ­¥éª¤1: Generator - ç”Ÿæˆå™¨ã€‘")
        print("="*70)
        print("Generatorçš„èŒè´£: æ‰§è¡Œä»»åŠ¡,ç”Ÿæˆå¹¶è¿è¡Œä»£ç ")
        print("\nç”Ÿæˆçš„ä»£ç :")
        print("```python")
        generated_code = """# è®¡ç®—1åˆ°100ä¹‹é—´æ‰€æœ‰å¶æ•°çš„å’Œ
total = sum(i for i in range(1, 101) if i % 2 == 0)
print(f"å¶æ•°ä¹‹å’Œ: {total}")"""
        print(generated_code)
        print("```")

        print("\næ‰§è¡Œç»“æœ:")
        print("å¶æ•°ä¹‹å’Œ: 2550")
        print("âœ… ä»£ç æ‰§è¡ŒæˆåŠŸ!")

        # Step 2: Reflector
        print("\n" + "-"*70)
        print("\nã€æ­¥éª¤2: Reflector - åæ€å™¨ã€‘")
        print("="*70)
        print("Reflectorçš„èŒè´£: åˆ†ææ‰§è¡Œç»“æœ,æå–è§è§£")

        reflection = {
            "reasoning": "ä»£ç ä½¿ç”¨äº†ç”Ÿæˆå™¨è¡¨è¾¾å¼å’Œsum()å‡½æ•°,è¿™æ˜¯Pythonä¸­è®¡ç®—åºåˆ—å’Œçš„æƒ¯ç”¨æ–¹æ³•ã€‚ä»£ç ç®€æ´ä¸”æ•ˆç‡é«˜ã€‚",
            "error_identification": "ä»£ç æ‰§è¡ŒæˆåŠŸ,æ²¡æœ‰é”™è¯¯ã€‚æ–¹æ³•é€‰æ‹©æ°å½“ã€‚",
            "root_cause_analysis": "ä½¿ç”¨äº†Pythonicçš„å†™æ³•,åˆ©ç”¨äº†å†…ç½®å‡½æ•°çš„ä¼˜åŒ–ã€‚",
            "correct_approach": "å¯¹äºè¿‡æ»¤å’Œæ±‚å’Œä»»åŠ¡,ä¼˜å…ˆä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼é…åˆsum()å‡½æ•°,è€Œä¸æ˜¯æ˜¾å¼çš„forå¾ªç¯ã€‚",
            "key_insight": "åœ¨Pythonä¸­å¤„ç†åºåˆ—è¿‡æ»¤å’Œèšåˆæ—¶,ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ + å†…ç½®å‡½æ•°(sum, max, minç­‰)æ¯”æ˜¾å¼å¾ªç¯æ›´ç®€æ´é«˜æ•ˆ"
        }

        print("\nç”Ÿæˆçš„åæ€:")
        for key, value in reflection.items():
            print(f"\nâ€¢ {key}:")
            print(f"  {value}")

        print("\nğŸ’¡ å…³é”®è§è§£: " + reflection["key_insight"])

        # Step 3: Curator
        print("\n" + "-"*70)
        print("\nã€æ­¥éª¤3: Curator - ç­–å±•äººã€‘")
        print("="*70)
        print("Curatorçš„èŒè´£: å°†è§è§£æ•´åˆä¸ºplaybookæ›´æ–°")

        new_bullet = Bullet(
            id=f"bullet-{len(self.playbook_bullets):05d}",
            section="code_patterns",
            content="å¯¹äºåºåˆ—è¿‡æ»¤æ±‚å’Œä»»åŠ¡,ä½¿ç”¨ sum(x for x in seq if condition) è€Œéæ˜¾å¼forå¾ªç¯"
        )

        self.playbook_bullets.append(new_bullet)

        print(f"\nç”Ÿæˆçš„æ›´æ–°æ“ä½œ:")
        print(f"â€¢ æ“ä½œç±»å‹: ADD")
        print(f"â€¢ æ·»åŠ åˆ°ç« èŠ‚: {new_bullet.section}")
        print(f"â€¢ å†…å®¹: {new_bullet.content}")
        print(f"â€¢ Bullet ID: {new_bullet.id}")

        print("\nâœ… Playbookå·²æ›´æ–°!")
        print(f"ğŸ“š å½“å‰PlaybookåŒ…å« {len(self.playbook_bullets)} æ¡çŸ¥è¯†")

        # å±•ç¤ºPlaybook
        print("\n" + "="*70)
        print("ğŸ“š å½“å‰Playbookå†…å®¹")
        print("="*70)

        if self.playbook_bullets:
            sections = {}
            for bullet in self.playbook_bullets:
                if bullet.section not in sections:
                    sections[bullet.section] = []
                sections[bullet.section].append(bullet)

            for section, bullets in sections.items():
                print(f"\n## {section.upper().replace('_', ' ')}")
                for bullet in bullets:
                    print(f"  [{bullet.id}] {bullet.content}")
        else:
            print("(ç©º)")

        # æ¼”ç¤ºå¢é‡æ›´æ–°çš„ä¼˜åŠ¿
        print("\n" + "="*70)
        print("ğŸ¯ ACEçš„æ ¸å¿ƒä¼˜åŠ¿")
        print("="*70)

        advantages = [
            ("å¢é‡æ›´æ–°", "åªæ·»åŠ æ–°çŸ¥è¯†,ä¸é‡å†™æ•´ä¸ªcontext,é¿å…ä¿¡æ¯ä¸¢å¤±"),
            ("ç»“æ„åŒ–å­˜å‚¨", "æ¯æ¡çŸ¥è¯†éƒ½æœ‰ç‹¬ç«‹ID,å¯ä»¥ç²¾ç¡®è¿½è¸ªå’Œæ›´æ–°"),
            ("é˜²æ­¢åç¼©", "ä¸ä¼šåƒä¼ ç»Ÿæ–¹æ³•é‚£æ ·å°†contextå‹ç¼©æˆç®€çŸ­æ‘˜è¦"),
            ("å¯è§£é‡Šæ€§", "æ¯æ¡çŸ¥è¯†éƒ½æœ‰æ˜ç¡®æ¥æº,äººç±»å¯è¯»"),
            ("å¯æ‰©å±•æ€§", "éšç€é•¿ä¸Šä¸‹æ–‡æ¨¡å‹å‘å±•,å¯ä»¥å®¹çº³æ›´å¤šçŸ¥è¯†")
        ]

        for title, desc in advantages:
            print(f"\nâœ… {title}")
            print(f"   {desc}")

        # ä¸‹ä¸€æ­¥æŒ‡å¼•
        print("\n" + "="*70)
        print("ğŸš€ ä¸‹ä¸€æ­¥")
        print("="*70)
        print("\nè¦ä½¿ç”¨çœŸå®çš„ACEç³»ç»Ÿ:")
        print("1. å®‰è£…ä¾èµ–: pip install google-adk")
        print("2. é…ç½®API: export GOOGLE_API_KEY='your-key'")
        print("3. è¿è¡Œå®Œæ•´ç‰ˆ: python ace_prototype.py")
        print("4. æŸ¥çœ‹æ–‡æ¡£: cat README_ACE.md")
        print("\næˆ–è¿è¡Œæµ‹è¯•å¥—ä»¶: python test_ace.py")


def show_architecture():
    """å±•ç¤ºACEçš„æ¶æ„å›¾"""
    print("\n" + "="*70)
    print("ğŸ—ï¸  ACE æ¶æ„ç¤ºæ„å›¾")
    print("="*70)

    architecture = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ç”¨æˆ·ä»»åŠ¡      â”‚
    â”‚  "è®¡ç®—å¶æ•°å’Œ"   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Generator (ç”Ÿæˆå™¨)                  â”‚
    â”‚  â€¢ æ¥æ”¶: ä»»åŠ¡ + å½“å‰Playbook        â”‚
    â”‚  â€¢ å¤„ç†: ç”Ÿæˆå¹¶æ‰§è¡ŒPythonä»£ç        â”‚
    â”‚  â€¢ è¾“å‡º: æ‰§è¡Œè½¨è¿¹ + ç»“æœ            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ trajectory
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Reflector (åæ€å™¨)                 â”‚
    â”‚  â€¢ æ¥æ”¶: æ‰§è¡Œè½¨è¿¹ + ç»“æœ            â”‚
    â”‚  â€¢ å¤„ç†: åˆ†ææˆåŠŸ/å¤±è´¥åŸå›           â”‚
    â”‚  â€¢ è¾“å‡º: ç»“æ„åŒ–åæ€                 â”‚
    â”‚    - é”™è¯¯è¯†åˆ«                       â”‚
    â”‚    - æ ¹å› åˆ†æ                       â”‚
    â”‚    - æ­£ç¡®æ–¹æ³•                       â”‚
    â”‚    - å…³é”®è§è§£                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ insights
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Curator (ç­–å±•äºº)                   â”‚
    â”‚  â€¢ æ¥æ”¶: åæ€ + å½“å‰Playbook        â”‚
    â”‚  â€¢ å¤„ç†: è¯†åˆ«æ–°çŸ¥è¯†                 â”‚
    â”‚  â€¢ è¾“å‡º: å¢é‡æ›´æ–°æ“ä½œ               â”‚
    â”‚    - ADD: æ·»åŠ æ–°bullet             â”‚
    â”‚    - é¿å…é‡å¤                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ delta updates
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Playbook (çŸ¥è¯†åº“)                  â”‚
    â”‚  â€¢ ç»“æ„åŒ–bulletsé›†åˆ                â”‚
    â”‚  â€¢ åˆ†sectionç»„ç»‡                    â”‚
    â”‚  â€¢ JSONæ ¼å¼æŒä¹…åŒ–                   â”‚
    â”‚  â€¢ æ”¯æŒæ£€ç´¢å’Œæ›´æ–°                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â””â”€â”€â”€â”€â”€â”€â”
                    â”‚ (ä¸‹æ¬¡ä»»åŠ¡æ—¶ä½¿ç”¨)
                    â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  æ–°ä»»åŠ¡...  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """
    print(architecture)


def show_comparison():
    """å±•ç¤ºä¸ä¼ ç»Ÿæ–¹æ³•çš„å¯¹æ¯”"""
    print("\n" + "="*70)
    print("âš–ï¸  ACE vs ä¼ ç»ŸPromptä¼˜åŒ–æ–¹æ³•")
    print("="*70)

    comparison = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      ç‰¹æ€§          â”‚   ä¼ ç»Ÿæ–¹æ³•       â”‚      ACE         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  æ›´æ–°æ–¹å¼          â”‚  æ•´ä½“é‡å†™        â”‚  å¢é‡æ·»åŠ         â”‚
    â”‚  çŸ¥è¯†ä¸¢å¤±          â”‚  å®¹æ˜“å‘ç”Ÿ        â”‚  æœ‰æ•ˆé¿å…        â”‚
    â”‚  Contexté•¿åº¦       â”‚  è¶‹å‘å˜çŸ­        â”‚  ç¨³å®šå¢é•¿        â”‚
    â”‚  å¯è§£é‡Šæ€§          â”‚  è¾ƒå·®            â”‚  é«˜              â”‚
    â”‚  é¢†åŸŸç»†èŠ‚          â”‚  æ˜“è¢«å‹ç¼©        â”‚  å®Œæ•´ä¿ç•™        â”‚
    â”‚  æ‰©å±•æ€§            â”‚  æœ‰é™            â”‚  å¥½              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ä¼ ç»Ÿæ–¹æ³•é—®é¢˜:
    âŒ Brevity Bias: å€¾å‘äºç®€æ´,ä¸¢å¤±é¢†åŸŸçŸ¥è¯†
    âŒ Context Collapse: è¿­ä»£é‡å†™å¯¼è‡´ä¿¡æ¯åç¼©

    ACEè§£å†³æ–¹æ¡ˆ:
    âœ… å¢é‡æ›´æ–°: åªæ·»åŠ æ–°å†…å®¹,ä¿ç•™æ—§çŸ¥è¯†
    âœ… ç»“æ„åŒ–: æ¯ä¸ªçŸ¥è¯†ç‚¹ç‹¬ç«‹ç®¡ç†
    âœ… Grow-and-Refine: ç¨³æ­¥å¢é•¿ + å®šæœŸå»é‡
    """
    print(comparison)


def main():
    """ä¸»å‡½æ•°"""
    print("\n" + "ğŸŒŸ"*35)
    print("æ¬¢è¿ä½¿ç”¨ ACE åŸå‹æ¼”ç¤º!")
    print("ğŸŒŸ"*35)

    demo = MockACEDemo()

    # 1. å±•ç¤ºæ¶æ„
    show_architecture()

    input("\næŒ‰Enterç»§ç»­æŸ¥çœ‹å·¥ä½œæµç¨‹æ¼”ç¤º...")

    # 2. æ¼”ç¤ºå·¥ä½œæµç¨‹
    demo.demonstrate_workflow()

    input("\næŒ‰Enterç»§ç»­æŸ¥çœ‹å¯¹æ¯”åˆ†æ...")

    # 3. å±•ç¤ºå¯¹æ¯”
    show_comparison()

    print("\n" + "="*70)
    print("âœ¨ æ¼”ç¤ºå®Œæˆ!")
    print("="*70)
    print("\nè¿™åªæ˜¯ä¸€ä¸ªæ¦‚å¿µæ¼”ç¤ºã€‚çœŸå®çš„ACEç³»ç»Ÿä¼š:")
    print("â€¢ ä½¿ç”¨Google Geminiæˆ–å…¶ä»–LLMä½œä¸ºåç«¯")
    print("â€¢ è‡ªåŠ¨æ‰§è¡ŒçœŸå®çš„Pythonä»£ç ")
    print("â€¢ æ™ºèƒ½åˆ†ææˆåŠŸå’Œå¤±è´¥æ¡ˆä¾‹")
    print("â€¢ æŒç»­ç§¯ç´¯å’Œä¼˜åŒ–çŸ¥è¯†åº“")
    print("\næŸ¥çœ‹å®Œæ•´å®ç°: ace_prototype.py")
    print("é˜…è¯»è¯¦ç»†æ–‡æ¡£: README_ACE.md")
    print("\n" + "="*70)


if __name__ == "__main__":
    main()
